<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ScanAR ‚Äì unlock on scan</title>
<script src="https://unpkg.com/html5-qrcode" defer></script>
<style>
  :root{--bg:#0f172a;--panel:#111827;--text:#e5e7eb;--muted:#9ca3af;--accent:#60a5fa;}
  *{box-sizing:border-box} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Arial;
  background:linear-gradient(180deg,var(--bg),#0b1025 40%,#0a0f22);color:var(--text);min-height:100svh;display:grid;place-items:center;padding:2rem}
  .card{width:min(720px,100%);background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.07);
    border-radius:1rem;padding:1.5rem;box-shadow:0 10px 30px rgba(0,0,0,.35);backdrop-filter:blur(6px)}
  h1{margin:0 0 .75rem;font-size:clamp(1.3rem,2.5vw + .6rem,2rem)} p{margin:0 0 1rem;color:var(--muted)}
  .row{display:flex;flex-wrap:wrap;gap:.75rem;margin-top:.5rem}
  button{appearance:none;border:1px solid rgba(255,255,255,.16);background:linear-gradient(180deg,#1f2937,#111827);
    color:var(--text);padding:.65rem 1rem;border-radius:.75rem;cursor:pointer;font-weight:600}
  button[disabled]{opacity:.5;cursor:not-allowed}
  .video-wrap{margin-top:1rem;display:none;border:1px solid rgba(255,255,255,.1);border-radius:.75rem;overflow:hidden;background:#000}
  .video-wrap.active{display:block} video{width:100%;display:block;background:#000}
  .status{margin-top:.5rem;font-size:.95rem} .ok{color:#86efac} .bad{color:#fca5a5}
  #scanner{margin-top:.75rem;border-radius:.75rem;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
  dialog{border:none;padding:0;border-radius:.75rem;overflow:hidden;background:var(--panel);color:var(--text);
    box-shadow:0 25px 80px rgba(0,0,0,.6),0 0 0 1px rgba(255,255,255,.08);max-width:min(420px,95vw)}
  dialog::backdrop{background:rgba(0,0,0,.55)} .modal-header{display:flex;justify-content:space-between;align-items:center;
    padding:.75rem 1rem;border-bottom:1px solid rgba(255,255,255,.08)} .modal-body{padding:.75rem;background:#0b1226}
  .modal-body img{max-width:100%;display:block;border-radius:.5rem}
</style>
</head>
<body>
  <main class="card">
    <h1>Scan to Unlock</h1>
    <p>Scan the QR code to reveal the content.</p>

    <!-- Scanner area -->
    <div id="scanner"></div>
    <div id="scanStatus" class="status">Waiting for camera‚Ä¶</div>

    <!-- Unlocked area (hidden until success) -->
    <section id="unlocked" style="display:none; margin-top:1.25rem;">
      <p class="status ok">‚úÖ Scan successful ‚Äî content unlocked.</p>
      <div class="row" role="group" aria-label="Media actions">
        <button id="toggleVideo" type="button" aria-expanded="false" aria-controls="videoRegion">‚ñ∂Ô∏è Play video</button>
        <button id="openImage" type="button">üñºÔ∏è Show image</button>
      </div>
      <div id="videoRegion" class="video-wrap" aria-live="polite">
        <video id="videoEl" controls preload="metadata" playsinline>
          <source src="video.mp4" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </div>
      <p class="status">Files expected in this folder: <code>video.mp4</code>, <code>image.png</code>.</p>
    </section>
  </main>

  <!-- Image Modal -->
  <dialog id="imgModal" aria-labelledby="imgTitle">
    <div class="modal-header">
      <strong id="imgTitle">Image preview</strong>
      <button id="closeModal" type="button" style="background:transparent;border:0;color:var(--text);font-size:18px;">‚úï</button>
    </div>
    <div class="modal-body">
      <img src="image.png" alt="Preview of image.png" loading="lazy">
    </div>
  </dialog>

<script>
  // ====== CONFIGURE THIS ======
  // Accept only this exact QR text. Leave as "" to accept ANY QR.
  const EXPECTED_CODE = "SCAN-OK";  // <-- change to your expected payload
  // ============================

  const scanStatus = document.getElementById('scanStatus');
  const scannerDiv = document.getElementById('scanner');
  const unlocked = document.getElementById('unlocked');

  // Start QR scanner when library loads
  window.addEventListener('load', async () => {
    if (!window.Html5Qrcode) {
      scanStatus.textContent = "Failed to load scanner library.";
      scanStatus.className = "status bad";
      return;
    }

    const html5QrCode = new Html5Qrcode("scanner");
    const config = { fps: 10, qrbox: { width: 250, height: 250 }, rememberLastUsedCamera: true };

    function onSuccess(decodedText) {
      const ok = !EXPECTED_CODE || decodedText.trim() === EXPECTED_CODE;
      if (!ok) {
        scanStatus.innerHTML = `‚ùå Wrong code scanned. Looking for: <code>${EXPECTED_CODE}</code>`;
        scanStatus.className = "status bad";
        return; // keep scanning
      }
      // Stop and hide scanner, unlock UI
      html5QrCode.stop().then(() => {
        scannerDiv.style.display = "none";
        scanStatus.style.display = "none";
        unlocked.style.display = "block";
        // optional: auto play video
        // document.getElementById('videoEl').play().catch(()=>{});
      });
    }

    function onError(errMsg) {
      // Noise is expected during scanning; keep it quiet
    }

    // Request camera and start
    try {
      scanStatus.textContent = "Requesting camera‚Ä¶";
      const cameras = await Html5Qrcode.getCameras();
      if (!cameras || !cameras.length) throw new Error("No camera found");
      scanStatus.textContent = "Point your camera at the QR code.";
      scanStatus.className = "status";
      await html5QrCode.start({ facingMode: "environment" }, config, onSuccess, onError);
    } catch (e) {
      scanStatus.textContent = "Camera unavailable: " + (e.message || e);
      scanStatus.className = "status bad";
    }
  });

  // ====== Media UI (same as before) ======
  const toggleBtn = document.getElementById('toggleVideo');
  const videoRegion = document.getElementById('videoRegion');
  const videoEl = document.getElementById('videoEl');
  function toggleVideo() {
    const isActive = videoRegion.classList.toggle('active');
    toggleBtn.setAttribute('aria-expanded', String(isActive));
    toggleBtn.textContent = isActive ? '‚èπÔ∏è Hide video' : '‚ñ∂Ô∏è Play video';
    if (isActive) videoEl.play().catch(()=>{});
    else videoEl.pause();
  }
  toggleBtn.addEventListener('click', toggleVideo);

  const modal = document.getElementById('imgModal');
  const openImage = document.getElementById('openImage');
  const closeModal = document.getElementById('closeModal');
  openImage.addEventListener('click', () => {
    if (typeof modal.showModal === 'function') modal.showModal();
    else window.open('image.png','_blank','noopener');
  });
  closeModal.addEventListener('click', () => modal.close());
  modal.addEventListener('cancel', e => { e.preventDefault(); modal.close(); });
  modal.addEventListener('click', e => {
    const r = modal.getBoundingClientRect();
    const inside = e.clientX>=r.left && e.clientX<=r.right && e.clientY>=r.top && e.clientY<=r.bottom;
    if (!inside) modal.close();
  });
</script>
</body>
</html>
